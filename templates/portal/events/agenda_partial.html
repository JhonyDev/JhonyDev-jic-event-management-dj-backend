{% if event.agendas.exists %}
{% for agenda in event.agendas.all %}
<div class="card mb-3">
  <div class="card-header">
    <div class="row align-items-center flex-column flex-md-row">
      <div class="col">
        <h4 class="card-title mb-0">{{ agenda.title }}</h4>
        <div class="card-subtitle text-muted">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-1" width="24" height="24" viewBox="0 0 24 24"
            stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <rect x="4" y="5" width="16" height="16" rx="2" />
            <line x1="16" y1="3" x2="16" y2="7" />
            <line x1="8" y1="3" x2="8" y2="7" />
            <line x1="4" y1="11" x2="20" y2="11" />
          </svg>
          {{ agenda.date|date:"F d, Y" }}
        </div>
      </div>
      <div class="col-auto">
        <div class="mt-2 mt-md-0">
          <span class="badge bg-primary-lt me-1 mb-1">Day {{ agenda.day_number }}</span>
          <span class="badge bg-secondary-lt me-1 mb-1">{{ agenda.sessions.count }} sessions</span>
        </div>
        {% if is_organizer %}
        <div class="btn-list mt-2 my-2">
          <button onclick="moveAgenda({{ event.pk }}, {{ agenda.pk }}, 'up')" class="btn btn-sm btn-outline-secondary"
            title="Move Up">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" width="16" height="16" viewBox="0 0 24 24"
              stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M7 14l5 -5l5 5" />
            </svg>
          </button>
          <button onclick="moveAgenda({{ event.pk }}, {{ agenda.pk }}, 'down')" class="btn btn-sm btn-outline-secondary"
            title="Move Down">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" width="16" height="16" viewBox="0 0 24 24"
              stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M7 10l5 5l5 -5" />
            </svg>
          </button>
          <a href="{% url 'portal:agenda_edit' event.pk agenda.pk %}?next={{ request.get_full_path|urlencode }}%23tab-agenda"
            class="btn btn-sm btn-outline-primary" title="Edit Agenda">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" width="16" height="16" viewBox="0 0 24 24"
              stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" />
              <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" />
              <path d="M16 5l3 3" />
            </svg>
          </a>
          <a href="{% url 'portal:agenda_delete' event.pk agenda.pk %}?next={{ request.get_full_path|urlencode }}%23tab-agenda"
            class="btn btn-sm btn-outline-danger" title="Delete Agenda"
            onclick="return confirm('Are you sure you want to delete this agenda? This will also delete all sessions within it.')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" width="16" height="16" viewBox="0 0 24 24"
              stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M4 7l16 0" />
              <path d="M10 11l0 6" />
              <path d="M14 11l0 6" />
              <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
              <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
            </svg>
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  {% if agenda.description %}
  <div class="card-body pt-2 pb-2">
    <p class="text-muted mb-0">{{ agenda.description }}</p>
  </div>
  {% endif %}

  {% if agenda.sessions.exists %}
  <div class="list-group list-group-flush">
    {% for session in agenda.sessions.all %}
    <div class="list-group-item">
      <div class="row align-items-center flex-column flex-md-row">
        <div class="col-auto">
          <div class="badge bg-{{ session.session_type|lower|slice:" :4" }}-lt">
            {{ session.start_time|time:"H:i" }}
          </div>
        </div>
        <div class="col">
          <div class="fw-medium">{{ session.title }}</div>
          <div class="text-muted small">
            {{ session.start_time|time:"g:i A" }} - {{ session.end_time|time:"g:i A" }}
            <span class="badge bg-azure-lt ms-2 ms-md-2 ms-0 mt-1 mt-md-0">{{ session.get_session_type_display }}</span>
          </div>

          <div class="mt-1">
            {% if session.location %}
            <span class="badge bg-info-lt badge-sm me-1 mb-1">{{ session.location }}</span>
            {% endif %}
            {% if session.speakers.exists %}
            {% for speaker in session.speakers.all %}
            <span class="badge bg-purple-lt badge-sm me-1 mb-1">{{ speaker.name }}</span>
            {% endfor %}

            {% endif %}
            {% if is_organizer %}
            <button type="button" class="btn btn-sm btn-ghost-secondary me-1" title="Manage Speakers"
              data-bs-toggle="modal" data-bs-target="#speakerModal"
              onclick="loadSpeakersForSession({{ session.pk }}, '{{ session.title|escapejs }}')">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-xs me-1" width="12" height="12"
                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                <path d="M6 21v-2a4 4 0 0 1 4 -4h2.5" />
                <path d="M16 19h6" />
                <path d="M19 16v6" />
              </svg>
              Manage Speakers
            </button>
            {% endif %}
          </div>
        </div>

        <div class="col-auto">
          {% if is_organizer %}
          <div class="btn-list ms-2 my-2">
            <button onclick="moveSession({{ event.pk }}, {{ agenda.pk }}, {{ session.pk }}, 'up')"
              class="btn btn-sm btn-outline-secondary" title="Move Up">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" width="12" height="12" viewBox="0 0 24 24"
                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M7 14l5 -5l5 5" />
              </svg>
            </button>
            <button onclick="moveSession({{ event.pk }}, {{ agenda.pk }}, {{ session.pk }}, 'down')"
              class="btn btn-sm btn-outline-secondary" title="Move Down">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" width="12" height="12" viewBox="0 0 24 24"
                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M7 10l5 5l5 -5" />
              </svg>
            </button>
            <a href="{% url 'portal:session_edit' event.pk agenda.pk session.pk %}?next={{ request.get_full_path|urlencode }}%23tab-agenda"
              class="btn btn-sm btn-outline-primary" title="Edit Session">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" width="14" height="14" viewBox="0 0 24 24"
                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" />
                <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" />
                <path d="M16 5l3 3" />
              </svg>
            </a>
            <a href="{% url 'portal:session_delete' event.pk agenda.pk session.pk %}?next={{ request.get_full_path|urlencode }}%23tab-agenda"
              class="btn btn-sm btn-outline-danger" title="Delete Session"
              onclick="return confirm('Are you sure you want to delete this session?')">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" width="14" height="14" viewBox="0 0 24 24"
                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M4 7l16 0" />
                <path d="M10 11l0 6" />
                <path d="M14 11l0 6" />
                <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
              </svg>
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% if is_organizer %}
  <div class="card-footer">
    <div class="text-center">
      <a href="{% url 'portal:session_create' event.pk agenda.pk %}?next={{ request.get_full_path|urlencode }}%23tab-agenda"
        class="btn btn-sm btn-outline-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-1" width="16" height="16" viewBox="0 0 24 24"
          stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M12 5l0 14" />
          <path d="M5 12l14 0" />
        </svg>
        Add Session to Agenda
      </a>
    </div>
  </div>
  {% endif %}
  {% else %}
  <div class="card-body text-center">
    <div class="text-muted">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2" width="24" height="24" viewBox="0 0 24 24"
        stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
      <div>No sessions in this agenda yet</div>
    </div>
  </div>
  {% if is_organizer %}
  <div class="card-footer">
    <div class="text-center">
      <a href="{% url 'portal:session_create' event.pk agenda.pk %}?next={{ request.get_full_path|urlencode }}%23tab-agenda"
        class="btn btn-sm btn-outline-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-1" width="16" height="16" viewBox="0 0 24 24"
          stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M12 5l0 14" />
          <path d="M5 12l14 0" />
        </svg>
        Add Session to Agenda
      </a>
    </div>
  </div>
  {% endif %}
  {% endif %}
</div>
{% endfor %}
{% else %}
<div class="empty">
  <div class="empty-icon">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <rect x="4" y="5" width="16" height="16" rx="2" />
      <line x1="16" y1="3" x2="16" y2="7" />
      <line x1="8" y1="3" x2="8" y2="7" />
      <line x1="4" y1="11" x2="20" y2="11" />
      <rect x="8" y="15" width="2" height="2" />
    </svg>
  </div>
  <p class="empty-title">No agendas created yet</p>
  {% if is_organizer %}
  <p class="empty-subtitle text-muted">Start by creating agendas to organize your event sessions</p>
  <div class="empty-action">
    <a href="{% url 'portal:agenda_create' event.pk %}" class="btn btn-primary">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24"
        stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
        <line x1="12" y1="5" x2="12" y2="19" />
        <line x1="5" y1="12" x2="19" y2="12" />
      </svg>
      Create First Agenda
    </a>
  </div>
  {% endif %}
</div>
{% endif %}